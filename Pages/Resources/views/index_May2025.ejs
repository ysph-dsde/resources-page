```{=html}

<head>
  <meta charset="UTF-8">
  <title>Resources - Two categories filter with sorting by title and date updated - May 10th, 2025</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>

<body>
  <div>
    <div class="main-container">
      <div class="sidebar-wrapper">
        <aside class="sidebar">
          <div class="sort-wrapper">
            <!-- <h5>Sort by:</h5> -->
            <select id="sortOptions" class="form-control" style="width: 94%;">
              <option value="title-asc">Title A-Z</option>
              <option value="title-desc">Title Z-A</option>
              <option value="date-asc">Date Updated: Oldest to Newest</option>
              <option value="date-desc">Date Updated: Newest to Oldest</option>
            </select>
          </div>
          <form id="categoryFilter1" class="form">
            <h5>Region and Affiliation</h5>
            <% if (items && items[0].items && items[0].items.length > 0) { %>
              <% const categories1 = new Set(); %>
              <% items[0].items.forEach(function(item) { 
                if (item.categories1) { 
                  item.categories1.forEach(function(cat) {
                    categories1.add(cat);
                  });
                }
              }); %>
              <% categories1.forEach(function(category) { %>
                <div class="checkbox-container">
                  <input type="checkbox" name="category1" value="<%= encodeURIComponent(category) %>">
                  <label style="margin-bottom: 0px;"><%= category %></label>
                </div>
              <% }); %>
            <% } %>
          </form>
          
          <br>
          
          <form id="categoryFilter2" class="form">
            <h5>Services Offered</h5>
            <% if (items && items[0].items && items[0].items.length > 0) { %>
              <% const categories2 = new Set(); %>
              <% items[0].items.forEach(function(item) { 
                if (item.categories2) { 
                  item.categories2.forEach(function(cat) {
                    categories2.add(cat);
                  });
                }
              }); %>
              <% categories2.forEach(function(category) { %>
                <div class="checkbox-container">
                  <input type="checkbox" name="category2" value="<%= encodeURIComponent(category) %>">
                  <label style="margin-bottom: 0px;"><%= category %></label>
                </div>
              <% }); %>
            <% } %>
          </form>
        </aside>
      </div>
      
      
      <div class="main-content">
        <div class="container" id="tilesContainer">
          <% items[0].items.forEach(function(item) { 
            if (item.tiles && item.tiles.length > 0) { 
              item.tiles.forEach(function(tile) { %>
                <div class="tile"
                     data-categories1="<%= item.categories1 ? item.categories1.map(cat => encodeURIComponent(cat)).join(' ') : '' %>"
                     data-categories2="<%= item.categories2 ? item.categories2.map(cat => encodeURIComponent(cat)).join(' ') : '' %>"
                     data-title="<%= tile.title %>"
                     data-date="<%= tile['date-updated'] %>">
                  <img src="<%- tile.image %>" class="image">
                  <h2 class="js-line-count"><%= tile.title %></h2>
                  <p class="description"><%= tile.description %></p>
                  <div class="card-header py-1 px-2 border-bottom bg-light">
                    <small class="card-text">
                      <% if (tile.github) { %>
                        &nbsp;
                        <a href="<%= tile.github %>" title="GitHub page" 
                        class="source-code" style="color: rgba(var(--bs-link-color-rgb), var(--bs-link-opacity, 1));">
                          <i class="bi-github"></i></a>
                      <% } %>
                      <% if (tile.site) { %>
                        &nbsp;
                        <a href="<%= tile.site %>" title="Main site" 
                        class="source-code" style="color: rgba(var(--bs-link-color-rgb), var(--bs-link-opacity, 1));">
                          <i class="bi-globe"></i></a>
                      <% } %>
                      <% if (tile.group) { %>
                        &nbsp;
                        <a href="<%= tile.group %>" title="Group site" 
                        class="source-code" style="color: rgba(var(--bs-link-color-rgb), var(--bs-link-opacity, 1));">
                          <i class="bi-people-fill"></i></a>
                      <% } %>
                      <% if (tile.article) { %>
                        &nbsp;
                        <a href="<%= tile.article %>" title="View publication" 
                        class="source-code" style="color: rgba(var(--bs-link-color-rgb), var(--bs-link-opacity, 1));">
                          <i class="bi-journal-text"></i></a>
                      <% } %>
                      <% if (tile.info) { %>
                        &nbsp;
                        <a href="<%= tile.info %>" title="Get more information" 
                        class="source-code" style="color: rgba(var(--bs-link-color-rgb), var(--bs-link-opacity, 1));">
                          <i class="bi-info-circle"></i></a>
                      <% } %>
                      <% if (tile.topic) { %>
                        <p class="topic" style="margin-bottom: 5px;"><%= tile.topic %></p>
                      <% } else { %>
                        <p class="topic" style="display:none; margin-bottom: 5px;"></p>
                      <% } %>
                    </small>
                  </div>
                </div>
              <% });
            } else { %>
              <p>No tiles found for this category.</p>
            <% }
          }); %>
        </div>
      </div>
    </div>
  </div>
  
  
  <script>
    function parseDate(dateStr) {
      return new Date(dateStr);
    }

    function updateLineCounts() {
      document.querySelectorAll(".tile").forEach(function(tile) {
        const h2Element = tile.querySelector(".js-line-count");
        const lineHeight = parseFloat(getComputedStyle(h2Element).lineHeight);
        
        const linesInH2 = Math.ceil(h2Element.scrollHeight / lineHeight);

        const pElement = tile.querySelector("p.description");
        pElement.style.display = '-webkit-box';
        pElement.style.webkitBoxOrient = 'vertical';
        pElement.style.overflow = 'hidden';

        let clampValue = 10; // Starting clamp value, assuming 2 will be taken for h2 and topic.

        // Adjust for number of lines in the title
        clampValue -= Math.max(0, linesInH2 - 1); // assumes at least one line for title
        
        // Adjust for number of lines in the topic
        const topicElement = tile.querySelector('.topic');
        if (topicElement && topicElement.style.display !== 'none') {
          const linesInTopic = Math.ceil(topicElement.scrollHeight / lineHeight);
          clampValue -= Math.max(0, linesInTopic - 1); // assumes at least one line for topic
        }

        if (clampValue < 1) clampValue = 1; // Ensure at least 1 line is available

        pElement.style.webkitLineClamp = clampValue;
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      updateLineCounts();
      window.addEventListener('resize', updateLineCounts);

      const categoryFilter1 = document.getElementById('categoryFilter1');
      const categoryFilter2 = document.getElementById('categoryFilter2');
      const sortOptions = document.getElementById('sortOptions');
      const tilesContainer = document.getElementById('tilesContainer');
      const tiles = Array.from(tilesContainer.querySelectorAll('.tile'));

      function filterTiles() {
        const selectedCategories1 = Array.from(categoryFilter1.querySelectorAll('input[name="category1"]:checked')).map(input => decodeURIComponent(input.value));
        const selectedCategories2 = Array.from(categoryFilter2.querySelectorAll('input[name="category2"]:checked')).map(input => decodeURIComponent(input.value));

        tiles.forEach(function(tile) {
          const categories1 = (tile.getAttribute('data-categories1') || '').split(' ').map(cat => decodeURIComponent(cat));
          const categories2 = (tile.getAttribute('data-categories2') || '').split(' ').map(cat => decodeURIComponent(cat));

          const matchesCategory1 = selectedCategories1.length === 0 || selectedCategories1.some(cat => categories1.includes(cat));
          const matchesCategory2 = selectedCategories2.length === 0 || selectedCategories2.some(cat => categories2.includes(cat));

          if (matchesCategory1 && matchesCategory2) {
            tile.style.display = 'block';
          } else {
            tile.style.display = 'none';
          }
        });

        // Apply sorting after filtering
        sortTiles();
        updateLineCounts(); // Update clamping after sorting
      }

      function sortTiles() {
        const sortValue = sortOptions.value;

        const visibleTiles = tiles.filter(tile => tile.style.display !== 'none');

        visibleTiles.sort((a, b) => {
          const titleA = a.getAttribute('data-title').toLowerCase();
          const titleB = b.getAttribute('data-title').toLowerCase();
          const dateA = parseDate(a.getAttribute('data-date'));
          const dateB = parseDate(b.getAttribute('data-date'));

          if (sortValue === 'title-asc') {
            return titleA.localeCompare(titleB);
          } else if (sortValue === 'title-desc') {
            return titleB.localeCompare(titleA);
          } else if (sortValue === 'date-asc') {
            return dateA - dateB;
          } else if (sortValue === 'date-desc') {
            return dateB - dateA;
          }

          return 0;
        });

        // Empty the container and append sorted visible tiles
        tilesContainer.innerHTML = '';
        visibleTiles.forEach(tile => tilesContainer.appendChild(tile));
      }

      categoryFilter1.addEventListener('change', filterTiles);
      categoryFilter2.addEventListener('change', filterTiles);
      sortOptions.addEventListener('change', sortTiles);
      filterTiles();
    });
  </script>
</body>

```

